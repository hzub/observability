<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/black.css" />

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/zenburn.css" />
    <link
      href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/reveal.js-plugins@latest/loadcontent/plugin.js"></script>
    <!-- <script src="plugin/highlight/highlight.js"></script> -->
  </head>
  <body>
    <div class="reveal">
      <!-- <div class="slides" data-load="slides_intro.html"></div> -->
      <!-- <div class="slides"></div> -->
      <div class="slides">
        <section>
          <strong class="text-orange-300">JS</strong> jak JavaScript,
          <strong class="text-blue-300">O</strong> jak Observability
          <p class="text-2xl">Hubert Zub, Future Conf 2023</p>
          <aside class="notes">
            <li>dzikuj za zaproszenie Andrzejowi</li>
            <li>z Biaegostoku</li>
            <li>Jutro o AI, dzi o JS</li>
            <li>no wanie - AI przetwarza sporo danych</li>
            <li>Bez tego 偶adna nowoczesna appka</li>
          </aside>
        </section>
        <section>
          <div>
            <p>Kto m贸wi?</p>
            <p class="fragment">Hubert</p>
            <ul class="fragment">
              <li>meet.js</li>
              <li><img width="40" height="40" src="logo.png" /> Databricks</li>
            </ul>
            <img src="download.jpeg" width="300" class="fragment" />
          </div>
          <aside class="notes">
            <li>data warehousy, lakes, przetwarzanie danych</li>
            <li>eksabajty danych</li>
            <li>
              databricks - mo偶liwe 偶e nie syszelicie, ale jestecie klientem
              firmy kt贸ra jest naszym klientem
            </li>
            <li>apple, adobe, cisco, hp, toyota, siemens</li>
          </aside>
        </section>
        <section>
          <section>
            <span style="opacity: 0.3"
              ><strong class="text-orange-300">JS</strong> jak JavaScript, </span
            ><strong class="text-blue-300">O</strong> jak Observability
            <aside class="notes">
              <li>teraz by wypadaa definicja</li>
              <li>wszyscy lubi definiowa</li>
              <li>i mog si o to bi (testy e2e, framework vs biblioteka)</li>
              <li>zdefiniujmy sami</li>
            </aside>
          </section>
          <section>Czy to zbieranie log贸w?</section>
          <section>
            A po co to komu? Kto tego potrzebuje?
            <aside class="notes">
              <li>
                czy my jako programici potrzebujemy zbierania du偶j iloci
                log贸w userzy korzystaj z apki
              </li>
              <li>
                my mo偶e nie, ale ci od produktu chc wiedzie czy mamy bdy w
                aplikacji
              </li>
              <li>albo czy aplikacja szybko dziaa</li>
              <li>albo czy featury kt贸re tworzymy w og贸le s wykorzystywane</li>
            </aside>
          </section>
          <section>
            <p>Czyli po pierwsze: bdy</p>
            <aside class="notes">
              zrobilicie aplikacj, wiecie 偶e jest bez bd贸w bo przecie偶
              popisalicie testy, wysyacie na produkcj. Checie sysze o
              bdach? No nie. Ale wasz account ju偶 tak, bo jak bdy bd
              krytyczne to on wieci oczami.
            </aside>
          </section>
          <section>
            <p>Po drugie: performance</p>
            <aside class="notes">
              jak pisalicie apk to przecie偶 migaa szybko. A nawet jak byo
              co wolno to zoptymalizowalicie. Przeskanowalicie web vitals,
              wszystko miga. To po co si tym przejmowa jak jest szybko. Jak
              co wolno to wiadomo 偶e to wina tych na backendzie. No ale
              tworzylicie appk na jakim macbooku kt贸ry ma 12 rdzeni i 32 gb
              ramu bo wam firma kupia. A user mo偶e mie biurowy komputer na
              przysowiowy wgiel. I p贸ki.
            </aside>
          </section>
          <section>
            <p>Po trzecie: analityka zdarze</p>
            <aside class="notes">
              czy potrzebujecie tego? Przecie偶 UX/UI zaprojektowa, narysowa,
              frontend jest postawiony wg designu. Potrzebujecie wiedzie jak
              userzy klikaj w kt贸re przyciski etc.? Mo偶e tak, mo偶e nie, ale
              dzia produktowy potrzebuje wiedzie czy zaprojektowa interfejs
              kt贸ry jest jasny. M贸g zrobi testy UXowe z userami, ale to ma
              skala. I kosztuje.
            </aside>
          </section>
          <section>
            <p>czemu te rzeczy <i>obserwujemy</i>?</p>
            <aside class="notes">
              <li>Czemu nie sprawdzimy tego wczeniej</li>
              <li>tylko teraz?</li>
              <li>
                observability pozwala nam robi (jedyne legalne) testy na
                produkcji - z DU呕 iloci user贸w
              </li>
              <li>zweryfikowa bdy</li>
            </aside>
          </section>
          <section>
            <p>na potrzeby prezentacji:</p>
            <ul>
              <li>raportowanie bd贸w</li>
              <li>metryki wydajnoci</li>
              <li>dane do analityki</li>
            </ul>
            <p class="fragment">(..na produkcji)</p>
            <aside class="notes">
              <li>
                to jest robocza definicja na potrzeby prezentacji, wierz mocno
                偶e masa ludzi chciaaby to zdefiniowa inaczej - bardzo chtnie
                si o to podyskutuje ale po prezce :)
              </li>
            </aside>
          </section>
          <section>
            <p>Englisz :</p>
            <ul>
              <li>error reporting</li>
              <li>performance metrics</li>
              <li>analytics events</li>
            </ul>
          </section>
          <section>
            Co z tego dzi om贸wimy?
            <aside class="notes">
              <li>dotkniemy ka偶dego tematu ze strony frontendu</li>
              <li>RAZ</li>
              <li>nie bdziemy omawia narzdzi - do tego s tutoriale</li>
              <li>lockrocket, datadog, sentry, grafana etc.</li>
              <li>
                mo偶e nawet na swoim backendzie macie customowe rozwizanie etc.
              </li>
              <li>
                nie m贸wi jak zestawi - ale jak dziaa na frontendzie, by te
                observability miao sens
              </li>
              <li>zwr贸ci uwag na uniwersalne praktyki, puapki etc</li>
              <li>DWA</li>
              <li>nie bd wam m贸wi ze warto</li>
              <li>bo to troche jak prezka o tym 偶 warto pisa testy</li>
            </aside>
          </section>
          <section>
            Zao偶enia:
            <ul>
              <li class="fragment">Mamy spity system do wysyania event贸w</li>
            </ul>
          </section>
        </section>

        <section data-background="#d57b7b">
          <section>
            <p>Cz I</p>
            <p><strong>Bdy</strong></p>
          </section>
          <section>
            <p>Potrzebujemy?</p>
            <aside class="notes">
              <li>Gadamy o tym czy nie gadamy, macie bezbdne aplikacje?</li>
              <li>
                Zakadamy 偶e mamy super CI wic 偶adne bdy czasu budowy:
                syntaxy etc. nie przejd wic interesuj nas tylko runtimey
              </li>
            </aside>
          </section>
          <section>
            <p>To co robimy z tymi bdami </p>
            <ul>
              <li class="fragment">#1: Nic</li>
              <li class="fragment">#2: adny modal + wylij prosz email</li>
              <li class="fragment">
                <strong>#3: adny modal + automatyzacja</strong>
              </li>
            </ul>
            <aside class="notes">
              <li>BANA</li>
              <li>1: nic nie robimy</li>
              <li>2: wywietlamy adny modal + email</li>
              <li>3: automatyzujemy</li>
            </aside>
          </section>

          <section>
            <p>Raportujemy bdy</p>
            <ul>
              <li class="fragment">
                Z pomoc narzdzi: Sentry, LogRocket etc.
              </li>
              <li class="fragment">
                Po swojemu: wasny system do raportowania
              </li>
            </ul>
            <p class="fragment">
              Cel: statystyka, reprodukcja, zaraportowanie, naprawa
            </p>
            <aside class="notes">
              <li>BANA</li>
              <li>mo偶e tak</li>
              <li>a moze tak</li>
            </aside>
          </section>
          <section>[OBRAZEK] flow jak idzie bd</section>
        </section>
        <section data-background="#d57b7b">
          <p>Puapki i praktyki</p>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Puapka #1</p>
            <p><strong>Logujemy za mao</strong></p>
            <aside class="notes">
              <li>BANA</li>
              <li>klasyk</li>
            </aside>
          </section>
          <section>
            <pre><code data-line-numbers="1-11|13-21|23-27|5-7|18-20" data-trim>class ApiService {
	async call() {
		const response = await fetch("...");
		if (!response.ok) {
			return Promise.reject(new Error(
        "Failed to fetch [URL]"
      ));
		}
		return response.json();
	}
}

function process() {
	new ApiService().call()
	  .then((data) => {
		  // ...
	  })
	  .catch((error) => {
		  // ?
	  });
}

document
	.querySelector("button")
	.addEventListener("click", () => {
		process();
	});
  </code></pre>
          </section>
          <section>
            <pre><code data-trim>
              .catch((error) => {
                console.log(error);
              });
			  </code></pre>
          </section>
          <section>
            <img src="img/bledy/1.png" width="100%"" />
            <p class="fragment">Z grubsza wszystko co wiemy 锔</p>
            <p class="fragment">Jaki ticket z tego wyjdzie?</p>
          </section>
          <section>
            <p>Co pomo偶e (atwe)?</p>
            <ul>
              <li class="fragment">
                Peny stack trace
                <ul>
                  <li>(za chwil)</li>
                </ul>
              </li>

              <li class="fragment">URL / historia URLi (route-贸w)</li>

              <li class="fragment"><code>navigator.*</code></li>
            </ul>
          </section>
          <section>
            <p>Co jeszcze pomo偶e?</p>
            <ul>
              <li class="fragment">odbitka feature flag</li>
              <li class="fragment">ewaluacja A/B</li>
            </ul>
          </section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Puapka #2</p>
            <p><strong>Logujemy za du偶o</strong></p>
            <aside class="notes">
              <li>mo偶na?</li>
            </aside>
          </section>
          <section>
            <img src="img/bledy/2.png" />
            <p class="fragment">Co tu jest nie tak?</p>
          </section>
          <section>
            <p class="fragment">Konstruujc bdy, raporty, logi:</p>
            <ul>
              <li class="fragment">
                Unikajmy treci tworzonych przez u偶ytkownik贸w
              </li>
              <li class="fragment">Najlepiej bazowa na URLach</li>
            </ul>
          </section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Puapka #3</p>
            <p><strong>Niekompletne stack trace'y</strong></p>
            <aside class="notes"></aside>
          </section>
          <section>
            <pre><code data-line-numbers="1-11|13-21|23-27|5-7|18-20" data-trim>class ApiService {
  async call() {
    const response = await fetch("...");
    if (!response.ok) {
      return Promise.reject(new Error(
        "Failed to fetch [URL]"
      ));
    }
    return response.json();
  }
}

function process() {
  new ApiService().call()
    .then((data) => {
      // ...
    })
    .catch((error) => {
      console.log(error.stack)
    });
}</code></pre>
          </section>
          <section><img src="img/bledy/1.png" width="100%" /></section>
          <section>
            <pre><code data-line-numbers="2|3-6" data-trim>function process() {
  const initiatorStack = new Error().stack;
  new ApiService().call().catch((error) => {
    console.log(error.stack);
    console.log(initiatorStack);
  });
}

document.querySelector("button").addEventListener("click", () => {
  process();
});
</code></pre>
          </section>
          <section><img src="img/bledy/3.png" /></section>
          <section>
            <pre><code data-line-numbers="4-8" data-trim>function process() {
  const initiatorStack = new Error().stack;
  new ApiService().call().catch((error) => {
    const completeStack = [
      error.stack,
      ...initiatorStack.split("\n").slice(1),
    ].join("\n");
    console.log(completeStack);
  });
}</code></pre>
          </section>
          <section><img src="img/bledy/4.png" /></section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Puapka #4</p>
            <p><strong>Brak informacji od u偶ytkownika</strong></p>
            <aside class="notes">
              <li>Pod spodem adnie wysya si bd</li>
              <li>A na wierzchu?</li>
            </aside>
          </section>
          <section><img src="img/bledy/5.png" width="100%" /></section>
          <section><img src="img/bledy/6.png" width="100%" /></section>
          <section>
            <p>Czy mo偶na lepiej?</p>
            <p class="fragment">A zrzut ekranu? </p>
          </section>
          <section>
            <pre><code data-trim data-line-numbers="|2-6|8-12|14-21">async function snapshot() {
  const stream = await navigator.mediaDevices
    .getDisplayMedia({
      preferCurrentTab: true,
    });
  const [track] = stream.getVideoTracks();

  const canvas = document.createElement("canvas");
  const video = document.createElement("video");
  video.srcObject = stream;

  await video.play();

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);

  canvas.toBlob((blob) => {
    track.stop();
    // Przetworzenie + wysanie bloba
  });
}
</code></pre>
          </section>
          <section><img src="img/bledy/7.png" width="100%" /></section>
          <section>Z autopsji: 锔 mocno pomogo lokalizowa bdy</section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Puapka #5</p>
            <p><strong>Testowanie raportowania</strong></p>
            <aside class="notes">
              <li>odpalacie system, stawiacie sentry czy co tam</li>
              <li>i nie ma bd贸w</li>
              <li>...i nie ma bd贸w</li>
              <li>to dobrze, prawda?</li>
              <li>warto napisa test kt贸ry zmockowane</li>
              <li>
                a bardziej warto napisa e2e kt贸ry bdzie siedzia w waszym CI i
                raz na miesic faktycznie wysypie stron i zgosi faktyczny
                raport
              </li>
            </aside>
          </section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Puapka #6</p>
            <p><strong>Niesp贸jny system logowania</strong></p>
            <aside class="notes"></aside>
          </section>
          <section>
            <pre><code data-trim data-line-numbers="1-13|15-18|20-23|25-30">
class ErrorWrapper extends Error {
  constructor(
    private error: string,
    private errorCode: number,
    private stackTrace = new Error().stack
  ) {
    super(error);
  }
  serialize() {
    const { error, stackTrace, errorCode } = this;
    return { error, stackTrace, errorCode };
  }
}

function doSomething1() {
  // ...
  throw new ErrorWrapper("Unauthorized", 401);
}

function doSomething2() {
  // ...
  throw { code: 401, message: "Unauthorized" };
}

function doSomething3() {
  // ...
  throw new Error(JSON.stringify(
    { code: 401, message: "Unauthorized" }
  ));
}

            </code></pre>
          </section>
        </section>
        <section data-background="#d57b7b">
          <p>Podsumowanie czci o bdach</p>
          <ul>
            <li class="fragment">Minimum do reprodukcji</li>
            <li class="fragment">Brak danych u偶ytkownika</li>
            <li class="fragment">Pene zrzuty stos贸w</li>
            <li class="fragment">Testujmy!</li>
          </ul>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>Cz II</p>
            <p><strong>Wydajno</strong></p>
          </section>
          <section>
            <p>Dlaczego?</p>
            <aside class="notes">
              <li>Znowu - problem macbooka programisty</li>
              <li>
                Celem jest by appka bya szybka/u偶ywalna przez wszystkich na
                wikszoci maszyn
              </li>
              <li>(chyba 偶e nie, ale to dziwny model biznesowy)</li>
            </aside>
          </section>
          <section>
            <p><em>"Czy aplikacja jest wystarczajco szybka"</em></p>
            <p>Jak na to odpowiedzie?</p>
          </section>
          <section>
            <p>Mo偶emy zmierzy</p>
            <ul>
              <li class="fragment">
                Czas renderu ekran贸w (poszczeg贸lnych czci)
              </li>
              <li class="fragment">Wskie garda, blokujce taski</li>
              <li class="fragment">Wielko pobieranych danych</li>
            </ul>
          </section>
          <section>
            <p>A gdyby tak pomiar E2E?</p>
            <aside class="notes">
              <li>
                Czas respons贸w z API. Wiecie, jak za dugie to problem bo te偶
                apka wolno dziaa. Ale to problem backendu, infry od networku,
                chmurowc贸w - ka偶dy zmierzy po swojemu.
              </li>
              <li>
                Ale my na frontendzie mamy wyjtkow, w zasadzie najlepsz
                pozycj do mierzenia
              </li>
              <li>
                Mo偶emy zebra ile e2eowo mija czasu od wysania ka偶dego requestu
                do otrzymania responsu
              </li>
            </aside>
          </section>
          <section>
            <p>[OBRAZEK - e2e flow]</p>
            <p class="fragment">Jak mo偶na dziaa:</p>
            <ul>
              <li class="fragment">
                Nazwanie ka偶dej interakcji (scenariusza, UJ, ...)
              </li>
              <li class="fragment">Raportowanie penego czasu interakcji</li>
              <li class="fragment">
                Dopenienie wskimi gardami oraz iloci zasob贸w
              </li>
            </ul>
          </section>
          <section>
            <p>Jak?</p>
            <ul>
              <li class="fragment">
                Start:
                <strong class="fragment"
                  >otwarcie aplikacji, nawigacja, akcja u偶ytkownika</strong
                >
              </li>
              <li class="fragment">
                Koniec: <strong class="fragment">interaktywno?</strong>
              </li>
            </ul>
          </section>
          <section>
            <pre><code><script type="text/template">const Komponent = () => {
  const [loading, setLoading] = useState(true);
  useEffect(() => {
    fetchData(...).then(() => {
      setLoading(false);
    });
  }, []);
  return (
    <Interaction name="DETAILS_TABLE_VIEW">
      <div>{/* ... */}</div>
      <InteractionBlock isLoading={loading} />
    </Interaction>
  );
}

</script></code></pre>
          </section>
          <section>
            <pre><code><script type="text/template">requestAnimationFrame(() => {
  // Odblokowanie
});</script></code></pre>
          </section>
          <section>
            <pre><code><script type="text/template">requestAnimationFrame(() => {
  requestAnimationFrame(() => {
    // Odblokowanie v2
  });
});</script></code></pre>
            <aside class="notes">
              <li>
                pierwszy rAF moze jeszcze wykonac si w tej samej ramce
                wykonania
              </li>
              <li>zagnie偶d偶ony bdzie na bank w kolejnej</li>
            </aside>
          </section>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>Puapka #1</p>
            <p><strong>Pomiar wpywa na pomiar</strong></p>
          </section>
          <section>
            <ul>
              <li class="fragment">
                Wasne, niestandardowe rozwizanie
                <ul>
                  <li>Kolejkowanie</li>
                  <li>Sampling</li>
                </ul>
              </li>
              <li class="fragment">
                Korzystanie z narzdzia
                <ul>
                  <li>Raczej jest sprawnie</li>
                </ul>
              </li>
            </ul>
          </section>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>Puapka #2</p>
            <p><strong>Kiepsko nazwane interakcje/scenariusze</strong></p>
          </section>
          <section>[SCREEN - "page load time"]</section>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>Podpowied藕</p>
            <p><strong>PerformanceObserver</strong></p>
          </section>
          <section>
            <pre><code data-line-numbers>const observer = new PerformanceObserver((list) => {
  console.log(list.getEntries()[0]);
});

observer.observe({
  type: "longtask",
});
            </code></pre>
          </section>
          <section>
            <pre><code data-trim data-line-numbers="|1-3|5-11|13-19"><script type="text/template">
<body>
  <div>test</div>
</body>

const observer = new PerformanceObserver((list) => {
  console.log(list.getEntries()[0]);
});

observer.observe({
  type: "longtask",
});

setTimeout(() => {
  for (let i = 0; i < 500; i++) {
    for (let j = 0; j < 500; j++) {
      document.querySelector("div").innerHTML = "x";
    }
  }
}, 1000);
            </script></code></pre>
          </section>
          <section>
            <img src="img/perf/1.png" width="100%" />
          </section>
          <section>
            <pre><code data-trim data-line-numbers="7-16|14"><script type="text/template">
const observer = new PerformanceObserver((list) => {
  for (const item of list.getEntries()) {
    console.log(item);
  }
});

observer.observe({
  entryTypes: [
    "mark",
    "measure",
    "longtask",
    "paint",
    "navigation",
    "resource",
  ],
});
            </script></code></pre>
          </section>
          <section>
            <img src="img/perf/2.png" width="100%" />
          </section>
          <section>
            <img src="img/perf/3.png" width="100%" />
          </section>
        </section>
        <section data-background="#3c3355">
          <p>Podsumowanie czci wydajnoci</p>
          <ul>
            <li class="fragment">Pomiary E2E</li>
            <li class="fragment">Organizacja interakcji</li>
            <li class="fragment">PerformanceObserver</li>
          </ul>
        </section>
        <section data-background="#185642">
          <p>Cz #3: Analityka</p>
        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealNotes,
          RevealLoadContent,
        ],
      });
    </script>
  </body>
</html>
