<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/black.css" />

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/zenburn.css" />
    <link href="tailwind.css" rel="stylesheet" />
    <!-- <script src="plugin/highlight/highlight.js"></script> -->
  </head>
  <body>
    <div class="reveal">
      <!-- <div class="slides" data-load="slides_intro.html"></div> -->
      <!-- <div class="slides"></div> -->
      <div class="slides">
        <section>
          <strong class="text-orange-300">JS</strong> jak JavaScript,
          <strong class="text-blue-300">O</strong> jak Observability
          <p class="text-2xl">Hubert Zub, Future Conf 2023</p>
          <aside class="notes">
            <li>nazywam si Hubert</li>
            <li>dzikuj za zaproszenie Andrzejowi</li>
            <li>z Biaegostoku</li>
            <li>Jutro o AI, dzi o JS</li>
            <li>no wanie - AI przetwarza sporo danych...</li>
            <li>Bez tego 偶adna nowoczesna appka</li>
          </aside>
        </section>
        <section>
          <h3>Kto m贸wi?</h3>
          <div style="display: grid; grid-auto-flow: column">
            <div
              style="
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5em;
              "
            >
              <div class="fragment" data-fragment-index="1"> Hubert Zub</div>
              <div
                class="fragment"
                data-fragment-index="2"
                style="display: flex; gap: 0.2em; align-items: center"
              >
                <img src="logomjs.png" style="width: 1em; margin: 0" />
                meet.js Biaystok
              </div>
              <div
                class="fragment"
                style="display: flex; gap: 0.2em; align-items: center"
                data-fragment-index="3"
              >
                <img src="logo.png" style="width: 1em; margin: 0" />
                Databricks
              </div>
            </div>
            <img
              src="download.jpeg"
              data-fragment-index="1"
              width="300"
              class="fragment"
              style="margin: 0"
            />
          </div>
          <aside class="notes">
            <li>data warehousy, lakes, przetwarzanie danych</li>
            <li>eksabajty danych</li>
            <li>
              databricks - mo偶liwe 偶e nie syszelicie, ale jestecie klientem
              firmy kt贸ra jest naszym klientem
            </li>
            <li>apple, adobe, hp, toyota, siemens, cisco</li>
          </aside>
        </section>
        <section>
          <section>
            <span style="opacity: 0.3"
              ><strong class="text-orange-300">JS</strong> jak JavaScript, </span
            ><strong class="text-blue-300">O</strong> jak Observability
            <aside class="notes">
              <li>teraz by wypadaa definicja</li>
              <li>wszyscy lubi definiowa</li>
              <li>i mog si o to bi (testy e2e, framework vs biblioteka)</li>
              <li>zdefiniujmy sami</li>
            </aside>
          </section>
          <section>
            <div>Wypuszczamy aplikacjna produkcj</div>
            <div class="fragment">
              Co <strike style="opacity: 0.3">chcemy</strike>musimy wiedzie o
              dalszych jej losach?
            </div>

            <aside class="notes">
              <li>czy dziaa</li>
              <li>a co to znaczy</li>
              <li>偶e userzy mog klika w featury</li>
              <li>偶e te featury dziaaj</li>
              <li>偶e te featury dziaaj szybko</li>
              <li>偶e te featury s znajdowalne przez user贸w!</li>
            </aside>
          </section>
          <section>
            A kto tego potrzebuje?
            <aside class="notes">
              <li>
                czy my jako programici potrzebujemy zbierania du偶j iloci
                log贸w userzy korzystaj z apki
              </li>
              <li>my mo偶e nie, ale ci od produktu</li>
              <li>albo czy aplikacja szybko dziaa</li>
              <li>albo czy featury kt贸re tworzymy w og贸le s wykorzystywane</li>
            </aside>
          </section>
          <section>
            <p>Ok, to ustalmy roboczo</p>
            <p>po pierwsze: <strong class="fragment">bdy</strong></p>
            <aside class="notes">
              zrobilicie aplikacj, wiecie 偶e jest bez bd贸w bo przecie偶
              popisalicie testy, wysyacie na produkcj. Checie sysze o
              bdach? No nie. Ale wasz account ju偶 tak, bo jak bdy bd
              krytyczne to on wieci oczami.
            </aside>
          </section>
          <section>
            <p>Po drugie: <strong class="fragment">performance</strong></p>
            <aside class="notes">
              jak pisalicie apk to przecie偶 migaa szybko. A nawet jak byo
              co wolno to zoptymalizowalicie. Przeskanowalicie web vitals,
              wszystko miga. To po co si tym przejmowa jak jest szybko. Jak
              co wolno to wiadomo 偶e to wina tych na backendzie. No ale
              tworzylicie appk na jakim macbooku kt贸ry ma 12 rdzeni i 32 gb
              ramu bo wam firma kupia. A user mo偶e mie biurowy komputer na
              przysowiowy wgiel. I p贸ki.
            </aside>
          </section>
          <section>
            <p>
              Po trzecie: <strong class="fragment">analityka zdarze</strong>
            </p>
            <aside class="notes">
              czy potrzebujecie tego? Przecie偶 UX/UI zaprojektowa, narysowa,
              frontend jest postawiony wg designu. Potrzebujecie wiedzie jak
              userzy klikaj w kt贸re przyciski etc.? Mo偶e tak, mo偶e nie, ale
              dzia produktowy potrzebuje wiedzie czy zaprojektowa interfejs
              kt贸ry jest jasny. M贸g zrobi testy UXowe z userami, ale to ma
              skala. I kosztuje.
            </aside>
          </section>
          <section>
            <p>
              Czemu te rzeczy <em><strong>obserwujemy</strong></em
              >?
            </p>
            <aside class="notes">
              <li>Czemu nie sprawdzimy tego wczeniej</li>
              <li>tylko teraz?</li>
              <li>
                observability pozwala nam robi (jedyne legalne) testy na
                produkcji - z DU呕 iloci user贸w
              </li>
            </aside>
          </section>
          <section>
            <p>Wic um贸wmy si () 偶e jest to:</p>
            <ul>
              <li class="fragment">Raportowanie bd贸w</li>
              <li class="fragment">Metryki wydajnoci</li>
              <li class="fragment">Analityka zdarze</li>
            </ul>
            <p class="fragment">...obserwowane na produkcji</p>
            <aside class="notes">
              <li>
                to jest robocza definicja na potrzeby prezentacji, wierz mocno
                偶e masa ludzi chciaaby to zdefiniowa inaczej - bardzo chtnie
                si o to podyskutuje ale po prezce :)
              </li>
            </aside>
          </section>

          <section>
            <div>Z czego dzi...</div>
            <ul>
              <li>Raportowanie bd贸w</li>
              <li>Metryki wydajnoci</li>
              <li style="opacity: 0.3"><strike>Analityka zdarze</strike></li>
            </ul>
            <aside class="notes">
              <li>
                skupi si na pierwszych dw贸ch bo tu zaobserwowaem najwicej
                ciekawostek
              </li>
              <li>
                o tym jak przygotowa dobrze kod pod analyticsy - do tego s
                tutoriale
              </li>
              <li>i raczej nie jest to rocket science</li>
            </aside>
          </section>

          <section>
            O czym NIE jest ta prezentacja?
            <aside class="notes">
              <li>RAZ</li>
              <li>
                nie bdziemy omawia jak zestawia narzdzia - do tego s
                tutoriale
              </li>
              <li>logrocket, datadog, sentry, grafana etc.</li>
              <li>
                mo偶e nawet na swoim backendzie macie customowe rozwizanie etc.
              </li>
              <li>DWA</li>
              <li>nie bd wam m贸wi ze warto</li>
              <li>bo to troche jak prezka o tym 偶 warto pisa testy</li>
            </aside>
          </section>
          <section>
            <p>O czym jest ta prezentacja?</p>

            <aside class="notes">
              <li>niewa偶ne jak zestawicie sobie zestaw do observability</li>
              <li>na co zwr贸ci uwag</li>
              <li>na jakie puapki uwa偶a</li>
              <li>jakie ciekawe triki zastosowa</li>
              <li>i jak podej do niekt贸rych niebanalnych temat贸w</li>
              <!-- <li>dotkniemy ka偶dego tematu ze strony frontendu</li>
              <li>zwr贸ci uwag na uniwersalne praktyki, puapki etc</li>
              <li>pokaza ciekawostki</li>
              -->
              <li>czyli JAK PISA APKI KTRE DA SI OBSERWOWA</li>
              <li>
                cel: jaka checklista w gowie, jak bedzie chwila to sobie
                spojrzycie na sw贸j system
              </li>
              <!--
              <li>
                problem: ka偶dy z tych temat贸w to mo偶e by oddzielna prezka, no
                ale...
              </li> -->
            </aside>
          </section>
        </section>

        <section data-background="#d57b7b">
          <section>
            <p>Cz I</p>
            <p><strong>Bdy</strong></p>
          </section>
          <section>
            <p>Potrzebujemy?</p>
            <aside class="notes">
              <li>
                Ju偶 rozmawialimy - wypuszczacie bezbdne aplikacje? JAk nie to
              </li>
              <li>
                Zakadamy 偶e mamy super CI wic 偶adne bdy czasu budowy:
                syntaxy etc. nie przejd wic interesuj nas tylko runtimey
              </li>
            </aside>
          </section>
          <section>
            <p>To co robimy z tymi bdami </p>
            <ol>
              <li class="fragment">Nic </li>
              <li class="fragment">
                adny modal + <em>please contact support</em>
              </li>
              <li class="fragment">
                <strong>adny modal + automatyczne raportowanie</strong>
              </li>
            </ol>
            <aside class="notes">
              <li>BANA</li>
              <li>1: nic nie robimy</li>
              <li>2: wywietlamy adny modal + email</li>
              <li>3: automatyzujemy</li>
            </aside>
          </section>

          <section>
            <p>Przypominajka/wyjanienie</p>
            <img src="img/sch/error.png" />
          </section>
          <section>
            Efekt skali
            <h1></h1>
          </section>
          <section>
            <p>Jak?</p>
            <ul>
              <li class="fragment">
                Gotowe narzdzia
                <br /><small
                  >(np. Datadog, Sentry, LogRocket, New Relic, etc.)</small
                >
              </li>
            </ul>
          </section>
          <section>
            <img src="img/tools/sentry.jpg" />
          </section>
          <section>
            <img src="img/tools/logrocket.png" />
          </section>
          <section>
            <p>Jak?</p>
            <ul>
              <li>
                Gotowe narzdzia
                <br /><small
                  >(np. Datadog, Sentry, LogRocket, New Relic, etc.)</small
                >
              </li>
              grtafa
              <li>
                Wasne raportowanie do bazy danych + system do przegldania
                <br /><small>(np. Grafana, JIRA?)</small>
              </li>
            </ul>
          </section>
          <section>
            <h4>Front-end</h4>
            <pre><code data-line-numbers="|3-7|11">// logErrorService.js

const reportError = (error) => {
  axios.post("/api/2.0/report-exception", {
    error: JSON.stringify(error)
  })
}

// someCodeFile.js

try {...} catch (e) { reportError(e); }

</code></pre>
          </section>
          <section>
            <h4>Back-end</h4>
            <pre><code data-line-numbers="|6-7">// errorService.ts

export class ErrorController {
  @Post()
  report(@Body() reportErrorDto: ReportErrorDto): string {
    // Myk do bazy danych
    this.errorService.report(reportErrorDto);
  }
}
</code></pre>
          </section>
          <section>
            <center><img src="img/sch/logs.png" width="100%"" /></center>
          </section>
          <section>
            <center>
              <img src="img/tools/grafana_dash.png" width="50%"" /> <img
              src="img/tools/grafana_log.png" width="50%"" />
            </center>
          </section>
          <section>
            <p>Cel?</p>
            <ul>
              <li class="fragment">Mo偶liwie szybka reprodukcja</li>
              <li class="fragment">Statystyka (!)</li>
              <li class="fragment">Alerting (!)</li>
              <li class="fragment">
                Unikamy zawracania  userowi
                <span class="fragment">(staramy si)</span>
              </li>
            </ul>
          </section>
        </section>

        <section data-background="#d57b7b">
          <section data-background="#d57b7b">
            <p>Puapki i praktyki</p>
          </section>
          <section>
            <p>Puapka #1</p>
            <p><strong>Logujemy za mao</strong></p>
            <aside class="notes">
              <li>to tylko na rozgrzewk</li>
              <li>TYCZY SIPRZEDE WSZYSTKIM WASNYCH</li>
              <li>ale nie tylko</li>
            </aside>
          </section>

          <!-- <section>
            <center>
              <img src="img/bledy/weak_error.png" />
            </center>
          </section> -->

          <section>
            <pre><code data-line-numbers="13-21|18-21|4-8" data-trim>class ApiService {
	async call() {
		const response = await fetch("...");
		if (!response.ok) {
			return Promise.reject(new Error(
        "Failed to fetch [URL]"
      ));
		}
		return response.json();
	}
}

function process() {
	new ApiService().call()
	  .then((data) => {
		  // ...
	  })
	  .catch((error) => {
      // Raportujemy bd
      reportError(error);
	  });
}
  </code></pre>
          </section>
          <section>
            <pre><code data-trim>
              .catch((error) => {
                console.log(error);
              });
			  </code></pre>
          </section>
          <section>
            <img src="img/bledy/1.png" width="100%"" />
            <p class="fragment">Z grubsza wszystko co wiemy 锔</p>
            <p class="fragment">Jaki ticket z tego wyjdzie?</p>
          </section>
          <section>
            <center><img src="img/bledy/weak_error.png" /></center>
          </section>
          <section>
            <p>Co pomo偶e (atwe)?</p>
            <ul>
              <li class="fragment">Peny stack trace</li>
              <li class="fragment">URL / historia URLi (route-贸w)</li>
              <li class="fragment"><code>navigator.*</code></li>
            </ul>
          </section>
          <section>
            <p>Stack trace - da si lepiej?</p>
          </section>
          <section>
            <pre><code data-line-numbers="5-7|18-20|23-27" data-trim>class ApiService {
  async call() {
    const response = await fetch("...");
    if (!response.ok) {
      return Promise.reject(new Error(
        "Failed to fetch [URL]"
      ));
    }
    return response.json();
  }
}

function process() {
  new ApiService().call()
    .then((data) => {
      // ...
    })
    .catch((error) => {
      console.log(error.stack)
    });
}

document
	.querySelector("button")
	.addEventListener("click", () => {
		process();
	});
</code></pre>
          </section>
          <section><img src="img/bledy/1.png" width="100%" /></section>
          <section>
            <pre><code data-line-numbers="2|3-6" data-trim>function process() {
  const initiatorStack = new Error().stack;
  new ApiService().call().catch((error) => {
    console.log(error.stack);
    console.log(initiatorStack);
  });
}

document
	.querySelector("button")
	.addEventListener("click", () => {
		process();
	});
</code></pre>
          </section>
          <section><img src="img/bledy/3.png" /></section>
          <section>
            <pre><code data-line-numbers="4-8" data-trim>function process() {
  const initiatorStack = new Error().stack;
  new ApiService().call().catch((error) => {
    const completeStack = [
      error.stack,
      ...initiatorStack.split("\n").slice(1),
    ].join("\n");
    console.log(completeStack);
  });
}</code></pre>
          </section>
          <section><img src="img/bledy/4.png" /></section>
          <section>
            Troch lepiej
            <center><img src="img/bledy/weak_error_b1.png" /></center>
          </section>
          <section>
            Jeszcze lepiej
            <center><img src="img/bledy/weak_error_b2.png" /></center>
          </section>
          <section>
            <p>Co jeszcze pomo偶e?</p>
            <ul>
              <li class="fragment">odbitka feature flag</li>
              <li class="fragment">ewaluacja A/B</li>
              <li class="fragment">identyfikacja u偶ytkownika</li>
            </ul>
          </section>
          <section>
            <center><img src="img/bledy/weak_error_b3.png" /></center>
          </section>
          <section>
            Nie logujmy za mao...
            <aside class="notes">
              Og贸lnie ci偶ko zalogowa za mao. To s lekkie i atwe dane
            </aside>
          </section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Puapka #2</p>
            <p><strong>Logujemy za du偶o</strong></p>
            <aside class="notes">
              <li>mo偶na?</li>
            </aside>
          </section>
          <section>
            <img src="img/bledy/token_in_log.png" width="100%" />
            <p>Co tu jest nie tak?</p>
          </section>
          <section>
            <img src="img/bledy/2.png" />
            <p>A tu?</p>
            <aside class="notes">
              <li>
                za贸偶my 偶e jest to ticket kt贸ry wlecia z raportowania bd贸w
              </li>
              <li>akurat przykad z JIRA</li>
              <li>account manager pinguje nas z tym bdem 偶e OMG</li>
              <li>
                bierzemy ticket, patrzymy co si dzieje, pr贸bujemy reprodukowa
              </li>
              <li>
                okazuje si 偶e klient w polu tekstowym u偶yjakiego dziwnego
                unicodowego zagranicznego znaczka
              </li>
              <li>i 偶e naprawicie, ale 偶e na razie to nie wolmo</li>
              <li>
                account bierze ticket i pisze zadowolony maila klientowi 偶e ten
                jego MERGE AND ACQUISITION to bdzie naprawiony
              </li>
              <li>
                klient te偶 jest zadowolony, czyta maila i dzwoni do prawnika
              </li>
            </aside>
          </section>

          <section>
            <p>Konstruujc bdy, raporty, logi:</p>
            <p class="fragment">锔</p>
            <aside class="notes">
              <li>Zwyczajowo wycinamy dane u偶ytkownika</li>
              <li>Wystarcz: identyfikatory, URLe, klucze</li>
              <li>Jak nie, to przemylmy architektur</li>
              <li>Z wyjtk贸w: wycinajmy tokeny, klucze, hasa etc.</li>
              <li>Im mniej danych u偶ytkownika tym lepiej</li>
              <li>A skoro o userze mowa</li>
            </aside>
          </section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>
              <strong>Wspom贸c si u偶ytkownikiem to a偶 nie taki grzech</strong>
            </p>
            <aside class="notes">
              <li>ok, mielimy mu nie zawraca gitary</li>
              <li>i robimy system kt贸ry sam bdzie zgasza</li>
              <li>ale czemu adnie nie spyta</li>
            </aside>
          </section>
          <section><img src="img/bledy/5.png" width="100%" /></section>
          <section>
            <p>Cel?</p>
            <li class="fragment">Mo偶liwie szybka reprodukcja</li>
          </section>
          <section><img src="img/bledy/6.png" width="100%" /></section>
          <section>
            <h3>Obserwacja</h3>
            <p>
              U偶ytkownicy czciej ni偶 nam si wydaje podaj kontekst/dodatkowe
              dane.
            </p>
            <p>
              <strong>U偶ytkownicy paccy jeszcze czciej.</strong>
            </p>
          </section>
          <section>
            <p>Czy mo偶na lepiej?</p>
            <p class="fragment">A zrzut ekranu? </p>
          </section>
          <section>
            <pre><code data-trim data-line-numbers="|2-6|8-12|14-21">async function snapshot() {
  const stream = await navigator.mediaDevices
    .getDisplayMedia({
      preferCurrentTab: true,
    });
  const [track] = stream.getVideoTracks();

  const canvas = document.createElement("canvas");
  const video = document.createElement("video");
  video.srcObject = stream;

  await video.play();

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);

  canvas.toBlob((blob) => {
    track.stop();
    // Przetworzenie + wysanie bloba
  });
}
</code></pre>
          </section>
          <section><img src="img/bledy/7.png" width="100%" /></section>
          <section>Z autopsji: 锔 mocno pomogo lokalizowa bdy</section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Co jeszcze?</p>
            <aside class="notes"></aside>
          </section>

          <section data-background="white">
            <img src="img/bledy/toomuch_1.png" />
          </section>

          <section data-background="white">
            <center>
              <img src="img/bledy/toomuch_2.png" width="50%" />
            </center>
          </section>
          <section>
            <p>Granice bd贸w w aplikacji</p>
            <aside class="notes"></aside>
          </section>
          <section>
            <pre style="width: 100%"><code>
              <script type="text/template">function Root() {
  return (
    <Routes>
      <Route path="/companies/*" element={<CompaniesRoutes />} />
      <Route path="/users/*" element={<UsersRoutes />} />
      <Route path="/" element={<HomePage />} />
      <Route path="*" element={<div>404</div>} />
    </Routes>
  );
}</script></code></pre>

            <pre style="width: 100%"><code>
              <script type="text/template">function CompaniesRoutes() {
  return (
    <Routes>
      <Route path="/:companyId" element={<CompanyDetails />} />
      <Route path="/new" element={<CompanyNew />} />
    </Routes>
  );
}</script></code></pre>
          </section>
          <section>
            <center class="r-stack">
              <img src="img/bledy/boundary1.png" />
              <img class="fragment" src="img/bledy/boundary2.png" />
            </center>
          </section>
          <section>
            <pre style="width: 100%"><code data-line-numbers="3,8">
              <script type="text/template">function CompaniesRoutes() {
  return (
    <AppErrorBoundary boundaryId="COMPANIES">
      <Routes>
        <Route path="/:companyId" element={<CompanyDetails />} />
        <Route path="/new" element={<CompanyNew />} />
      </Routes>
    </AppErrorBoundary>
  );
}</script></code></pre>
            <pre style="width: 100%"><code>
  <script type="text/template">// ...
  const { boundaryId } = useAppErrorBoundary();
  const onError = (error) => reportError(error, { boundaryId });
// ...</script></code></pre>
            <aside class="notes">react-error-boundary</aside>
          </section>
          <section>
            <p>Albo...</p>
            <p class="fragment">Niesp贸jna struktura wyjtk贸w</p>
            <aside class="notes"></aside>
          </section>
          <section>
            <pre><code data-trim data-line-numbers="1-13|15-18|20-23|25-30">
class ErrorWrapper extends Error {
  constructor(
    private error: string,
    private errorCode: number,
    private stackTrace = new Error().stack
  ) {
    super(error);
  }
  serialize() {
    const { error, stackTrace, errorCode } = this;
    return { error, stackTrace, errorCode };
  }
}

function akcja1() {
  // ...
  reportError(new ErrorWrapper("Unauthorized", 401));
}

function akcja2() {
  // ...
  reportError({ code: 401, message: "Unauthorized" });
}

function akcja3() {
  // ...
  reportError({ 
    error: JSON.stringify({
      code: 401, message: "Unauthorized"
    })
  })
}
            </code></pre>
          </section>
        </section>
        <section data-background="#d57b7b">
          <section>
            <p>Jeszcze jedna puapka...</p>
            <p class="fragment">
              <strong>Co jeli logi nie przychodz?</strong>
            </p>
            <aside class="notes">Testowanie</aside>
          </section>
          <section>
            <h1>ジ</h1>
            <aside class="notes">
              <li>odpalacie system, stawiacie sentry czy co tam</li>
              <li>i nie ma bd贸w</li>
              <li>...i nie ma bd贸w</li>
              <li>to dobrze, prawda?</li>
              <li>warto napisa test kt贸ry zmockowane</li>
              <li>
                a bardziej warto napisa e2e kt贸ry bdzie siedzia w waszym CI i
                raz na miesic faktycznie wysypie stron i zgosi faktyczny
                raport
              </li>
            </aside>
          </section>
        </section>

        <section data-background="#d57b7b">
          <p>Podsumowanie czci o bdach</p>
          <ul>
            <li class="fragment">Logujmy sporo...</li>
            <li class="fragment">...tylko bez wra偶liwych danych</li>
            <li class="fragment">Pene zrzuty stos贸w</li>
            <li class="fragment">Sp贸jna forma</li>
            <li class="fragment">Testujmy!</li>
          </ul>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>Cz II</p>
            <p><strong>Wydajno</strong></p>
          </section>
          <section>
            <p>Dlaczego?</p>
            <aside class="notes">
              <li>Znowu - problem macbooka programisty</li>
              <li>
                Celem jest by appka bya szybka/u偶ywalna przez wszystkich na
                wikszoci maszyn
              </li>
              <li>(chyba 偶e nie, ale to dziwny model biznesowy)</li>
            </aside>
          </section>
          <section>
            <p><em>"Czy aplikacja jest wystarczajco szybka"</em></p>
            <p class="fragment">Jak na to odpowiedzie?</p>
          </section>
          <section>
            <p>Mo偶emy zmierzy:</p>
            <ul>
              <li class="fragment">
                Czas renderu ekran贸w (poszczeg贸lnych czci)
              </li>
              <li class="fragment">Wskie garda, blokujce taski</li>
              <li class="fragment">Wielko pobieranych danych</li>
            </ul>
            <p class="fragment">Jak?</p>
            <ul>
              <li class="fragment">Dynamicznie (performance, Cypress)</li>
              <li class="fragment">Statycznie (Lighthouse etc.)</li>
            </ul>
          </section>
          <section>
            Czy to wystarczy do odpowiedzi na pytanie? 锔
            <aside class="notes">
              <li>"Czy aplikacja jest wystarczajco szybka"</li>
              <li>Mo偶e odpowiada, ale nie u偶ywamy wtedy wcale observability</li>
            </aside>
          </section>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>Co tak naprawd nas interesuje?</p>
            <p class="fragment">A gdyby tak E2E?</p>
            <aside class="notes">
              <li>Co tak naprawd nas interesuje?</li>
              <li>
                MO呕EMY Czas respons贸w z API. Wiecie, jak za dugie to problem bo
                te偶 apka wolno dziaa. Ale to problem backendu, infry od
                networku, chmurowc贸w - ka偶dy zmierzy po swojemu.
              </li>
              <li>MO呕EMY czas ekran贸w</li>
              <li>MO呕EMY zasoby</li>
              <li>
                Ale my na frontendzie mamy wyjtkow, w zasadzie najlepsz
                pozycj do mierzenia
              </li>
              <li>JAKI INNY AKTOR potrafi zebrta tak dane</li>
            </aside>
          </section>
          <section>
            <center><img src="img/sch/perf.png" /></center>
            <aside class="notes">
              <li>Start jakiej akcji (INTERAKCJI) - nawigacja, klik etc</li>
              <li>Cosi dzieje.</li>
              <li>Mo偶e to by adowanie strony</li>
              <li>Mo偶e to by adowanie kolejnej strony czyli nawigacja</li>
              <li>
                Mo偶e to by akcja kt贸ra odzywa si do API i co przetwarza
              </li>
              <li>Co interesuje user贸w? Kiedy mog robidalej</li>
            </aside>
          </section>
          <section>
            <ul>
              <li>
                Start:<br />
                <strong
                  >otwarcie aplikacji, nawigacja, akcja u偶ytkownika</strong
                >
              </li>
              <br />
              <li>Koniec:<br /><strong>interaktywno?</strong></li>
            </ul>
          </section>
          <section>I to mo偶na mierzy</section>
          <section>
            <p>Jak mo偶na dziaa:</p>
            <ul>
              <li class="fragment">
                Zdefiniowanie/nazwanie ka偶dej interakcji (scenariusza, UJ, ...)
              </li>
              <li class="fragment">Raportowanie penego czasu interakcji</li>
              <li class="fragment">Od interaktywnoci do interaktywnoci</li>
              <li class="fragment">(+ dopenienie "suchymi" danymi)</li>
            </ul>
          </section>
          <section>
            <p>Pomysy na implementacj?</p>
            <ul>
              <li class="fragment">
                Rozpoczynanie interakcji przy nawigacji (nasuch na routerze)
              </li>
              <li class="fragment">
                Rozpoczynanie interakcji na 偶danie (zdarzenie na elemencie)
              </li>
              <li class="fragment">Zale偶nie od frameworka</li>
            </ul>
          </section>

          <section>
            <pre><code data-line-numbers="5-6"><script type="text/template">const Routes = () => {
  const location = useLocation();

  useEffect(() => {
    const interaction = getInteraction(location.path);
    startInteraction(location.path);
  }, [location])
  
  return (
    <Routes>
      <Route path="/tables" element={...} />
      <Route path="/users" element={...} />
    </Routes>
  );
}

</script></code></pre>
          </section>
          <section>
            <pre><code data-line-numbers="2-5,10"><script type="text/template">const View = () => {
  const loadUsers = useCallback(() => {
    startInteraction('LOADING_USERS');
    fetchUsersFromApi(...);
  }, [])
  
  return (
    <div>
      {/* ... */}
      <button onClick={loadUsers}>Load</button>
    </div>
  );
}

</script></code></pre>
          </section>

          <section>
            <pre><code data-line-numbers="|9-14"><script type="text/template">const View = () => {
  const [loading, setLoading] = useState(true);
  const [data, setData] = useState(null);
  
  useEffect(... => ...)
  
  return (
    <div>
      <InteractionBlock
        name="PAGE_CLIENTS_TABLE_VIEW" 
        isBlocked={loading}
      >
        {loading ? <Spinner /> : data.map(... => ...)}
      </Interation>
    </div>
  );
}

</script></code></pre>
          </section>

          <section>
            <pre><code data-line-numbers="10-14"><script type="text/template"><div class="feed-toggle">
  <ul class="nav nav-pills outline-active">
    
    <li [hidden]="!listConfig.filters.tag">
      <a class="nav-link active">
        {{ listConfig.filters.tag }}
      </a>
    </li>
  </ul>
  <interaction-pending
    name="CLIENT_TABLE_LOADING"
    [loading]="loading"
  >
  </interaction-pending>
</div></script></code></pre>
          </section>

          <section>
            <p>A kiedy skoczy i zaraportowa?</p>
            <p class="fragment">Podpowied藕: interaktywno</p>
          </section>
          <section>
            <h1></h1>
          </section>
          <section>
            <pre><code><script type="text/template">requestAnimationFrame(() => {
  // Odblokowanie
});</script></code></pre>
          </section>
          <section>
            <pre><code><script type="text/template">requestAnimationFrame(() => {
  requestAnimationFrame(() => {
    // Odblokowanie
  });
});</script></code></pre>
            <aside class="notes">
              <li>
                pierwszy rAF moze jeszcze wykonac si w tej samej ramce
                wykonania
              </li>
              <li>zagnie偶d偶ony bdzie na bank w kolejnej</li>
            </aside>
          </section>
          <section>
            <center><img src="img/sch/perf.png" /></center>
            <aside class="notes">
              <li>Z autopsji: 锔 dziaa cakiem nie藕le</li>
            </aside>
          </section>
          <section>
            <pre
              style="width: 100%"
            ><code data-line-numbers><script type="text/template">interactionTracker.onInteractionFinish((interaction) => {
  axios.post("/api/2.0/report-performance", { interaction })
});</script></code></pre>
            <pre
              style="width: 100%"
            ><code data-line-numbers><script type="text/template">export class PerformanceController {
  @Post()
  report(@Body() reportDto: ReportDto): string {
    // Myk do bazy danych
    this.performanceService.report(reportDto);
  }
}
</script></code></pre>
            <div
              class="fragment"
              style="
                background-color: white;
                text-align: center;

                padding: 0.5em;
              "
            >
              <center>
                <img src="img/sch/logs.png" style="height: 5em" />
              </center>
            </div>
          </section>
          <section>
            <center>
              <img src="img/perf/grafana_perf_log.png" />
            </center>
          </section>
          <section>
            <center>
              <img src="img/perf/grafana_perf_graph.png" />
            </center>
          </section>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>A co ze szczeg贸ami?</p>
            <ul>
              <li class="fragment">Wskie garda</li>
              <li class="fragment">Ilo zasob贸w</li>
            </ul>
          </section>
          <section>
            <p>Wskie garda</p>
            <ul>
              <li class="fragment">Mo偶emy duba rcznie</li>
              <li class="fragment">...<code>PerformanceObserver</code></li>
            </ul>
          </section>
          <section>
            <pre><code data-line-numbers>const observer = new PerformanceObserver(...);

observer.observe({
  type: "longtask",
});
            </code></pre>
          </section>
          <section>
            <pre><code data-trim data-line-numbers="|1-3|5-7|9-15"><script type="text/template">const observer = new PerformanceObserver((list) => {
  console.log(list.getEntries()[0]);
});

observer.observe({
  type: "longtask",
});

setTimeout(() => {
  for (let i = 0; i < 500; i++) {
    for (let j = 0; j < 500; j++) {
      document.querySelector("div").innerHTML = "x";
    }
  }
}, 1000);
            </script></code></pre>
          </section>
          <section>
            <img src="img/perf/1.png" width="100%" />
          </section>
          <section>
            <pre><code data-trim data-line-numbers="7-16|14"><script type="text/template">
const observer = new PerformanceObserver((list) => {
  for (const item of list.getEntries()) {
    console.log(item);
  }
});

observer.observe({
  entryTypes: [
    "mark",
    "measure",
    "longtask",
    "paint",
    "navigation",
    "resource",
  ],
});
            </script></code></pre>
          </section>
          <section>
            <img src="img/perf/2.png" width="100%" />
          </section>
          <section>
            <img src="img/perf/3.png" width="100%" />
          </section>
        </section>
        <section data-background="#3c3355">
          <section>
            <p>Kolejna puapka</p>
            <p class="fragment"><strong>Pomiar wpywa na pomiar</strong></p>
          </section>
          <section>
            <div>Jak to rozwiza?</div>
            <ul>
              <li class="fragment">Kolejkowanie</li>
              <li class="fragment">Sampling</li>
            </ul>
          </section>
          <section>
            <p>Co jeszcze?</p>
            <p>Nazywanie interakcji</p>
            <ul>
              <li class="fragment" style="color: orangered">
                <code>LOAD_TABLE</code>
              </li>
              <li class="fragment" style="color: white">
                <code>customers.details_view.LOAD_TABLE</code>
              </li>
            </ul>
          </section>
        </section>

        <section data-background="#3c3355">
          <p>Podsumowanie czci wydajnoci</p>
          <ul>
            <li class="fragment">Pomiary E2E</li>

            <small
              ><li class="fragment" style="margin-left: 1em">
                (+ wskie garda)
              </li>
              <li class="fragment" style="margin-left: 1em">(+ zasoby)</li>
              <li class="fragment" style="margin-left: 1em">
                (+ dodatkowe metadane)
              </li></small
            >

            <li class="fragment"><code>PerformanceObserver</code></li>
            <li class="fragment">Organizacja interakcji</li>
          </ul>
        </section>
        <section data-background="#185642">
          <section>
            <p>Jak to wszystko lduje w jednym wiaderku?</p>
            <h1></h1>
          </section>
          <section>
            <ul>
              <li>Raportowanie bd贸w</li>
              <li>Metryki wydajnoci</li>
              <li class="fragment highlight-green">Analityka zdarze</li>
            </ul>
          </section>
          <section>
            <pre><code data-line-numbers="|8-10|2-4|5">const reportClick = (event) => {
  const report = () => axios.post("/api/report-event", {
    event: serializeEvent(event)
  });
  queueReport(report);
}

document.addEventListener('click', (e) => {
  reportClick(e);
});
</code></pre>
          </section>
          <section>
            <pre><code data-line-numbers><script type="text/template">window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-XXXXXXX');
            </script></code></pre>
          </section>
          <section data-background="#74c9ad">
            <img src="img/sch/logs-compl1.png" width="100%" />
          </section>
          <section>
            <p>I co z tego? え</p>
          </section>
          <section data-background="#74c9ad">
            <div class="r-stack">
              <img src="img/sch/logs-compl1.png" width="100%" />
              <img
                class="fragment"
                src="img/sch/logs-compl2.png"
                width="100%"
              />
            </div>
            <aside class="notes">
              Kiedy klikao si filtry i pisao algorytmy
            </aside>
          </section>
          <section>
            <ul>
              <li class="fragment" style="margin-bottom: 1em">
                Znajdowanie powtarzalnie problematycznych obszar贸w aplikacji
              </li>
              <li class="fragment" style="margin-bottom: 1em">
                Identyfikacja skali ra偶enia bd贸w
              </li>
              <li class="fragment" style="margin-bottom: 1em">
                Optymalizacja wydajnoci (np. przy segmentacji geograficznej)
              </li>
              <li class="fragment" style="margin-bottom: 1em">
                Przewidywanie rezygnacji (np. wzgldem wydajnoci)
              </li>

              <aside class="notes">
                <li>
                  1 z historycznych danych wynika 偶e najdu偶ej trwaj interakcje
                  z tego moduu? mo偶e trzeba zajrze w silnik tabelek?
                </li>
                <li>
                  1 a mo偶e wcia偶 powtarzajsi tam bdy 503, mo偶e trzeba
                  zajrze w proxy wok贸 tego mikroserwisu?
                </li>
                <li>
                  2 mo偶e bd by bahy z raportu i niekrytyczny, ale z jakiego
                  powodu po jego wystpieniu userzy przestaj korzysta
                </li>
                <li>
                  3 z takich metryk mo偶e nam wyj 偶e akurat responsy z networku
                  trwaj najdu偶ej dla grupy z azji rodkowej - trzeba dorzuci
                  do pieca
                </li>
                <li>
                  4 mo偶e to dugie interakcje powoduj 偶e userzy odchodz?
                </li>
              </aside>
            </ul>
          </section>
          <section>...ale to wszystko zale偶y od jakoci danych</section>
          <section>
            <p>Czyli</p>
            <ul>
              <li>Zbieranie kompletnych raport贸w bd贸w</li>
              <small><li>+ uatwienie sobie 偶ycia</li></small>
              <li>Poprawne nagrywanie wydajnoci</li>
            </ul>
          </section>
          <section>
            <p>Pytania!</p>
          </section>
          <section>
            <p>Idzcie i obserwujcie! </p>
          </section>
        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,

        highlight: {
          // beforeHighlight: (hljs) => hljs.registerLanguage("asdf"),
        },

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
      });
    </script>
  </body>
</html>
